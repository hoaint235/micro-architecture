name: $(BuildID)

trigger:
  branches:
    include:
      - master
      - feature/*
  paths:
    include:
      - "/source/front-end/back-office/modules/mra-admin/*"

pr:
  - master

pool:
  vmImage: ubuntu-latest

variables:
  - name: FIREBASE_TOKEN
    value: 0e7EL5p0cB3mwCgYIARAAGA4SNwF-L9IrRJTJPOXWPVQXxHCQT7HkQbyqDBjJHNmSR4kr1hea6j_B4axlcXw9kcdFT_fS_p5WiTQ
  - name: Workspace
    value: $(Pipeline.Workspace)/s

stages:
  - stage: Install
    jobs:
      - job: InstallJob
        displayName: InstallJob
        steps:
          - script: yarn install
            name: YarnInstall
            displayName: Yarn install
            workingDirectory: "$(Workspace)"

  - stage: CodeReview
    jobs:
      - job: CodeReviewJob
        displayName: CodeReviewJob
        steps:
          - script: yarn format && yarn check-format
            name: YarnFormat
            displayName: Yarn format
            workingDirectory: "$(Workspace)"

  - stage: Build
    jobs:
      - job: BuildJob
        displayName: BuildJob
        steps:
          - script: yarn build
            name: YarnBuild
            displayName: Yarn build
            workingDirectory: "$(Workspace)"

  - stage: Deploy
    jobs:
      - job: DeployFirebase
        displayName:
        steps:
          - script: 'firebase deploy --token "$(FIREBASE_TOKEN)" -m "$(Build.BuildNumber)"'
            workingDirectory: '$(System.DefaultWorkingDirectory)\\build'
            displayName: 'firebase publish -m "$(Build.BuildNumber)"'
